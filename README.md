# KMP-Algorithm-Swift
swiftç‰ˆçš„KMPç®—æ³•ã€‚

![KMP-BG.jpg](http://upload-images.jianshu.io/upload_images/968977-430b2eed104c4d5a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

>ä¸ºä»€ä¹ˆè¦å†™KMPå­—ç¬¦ä¸²åŒ¹é…ç®—æ³•å‘¢ï¼Ÿå› ä¸ºè¿‘æ®µæ—¶é—´åœ¨è¡¥æ•°æ®ç»“æ„å’Œç®—æ³•ï¼Œç„¶åé‡æ‹¾å¤§å­¦çš„ã€Šå¤§è¯æ•°æ®ç»“æ„ã€‹ï¼Œè®°å½•ä¸€ä¸‹å­¦ä¹ çš„è¿›åº¦ã€‚

### ä»€ä¹ˆæ˜¯KMPç®—æ³•ï¼Ÿ
KMPç®—æ³•æ˜¯ä¸€ç§å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º **O(n+m)ï¼ˆnæ˜¯æ–‡æœ¬çš„é•¿åº¦ï¼Œmæ˜¯æ¨¡å¼å­—ç¬¦ä¸²çš„é•¿åº¦ï¼‰**ï¼Œç›¸æ¯”äºä¼ ç»Ÿçš„å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•çš„æ—¶é—´è´Ÿå¤æ‚åº¦ **O(n * m)** æ¥è¯´ï¼Œå¤§å¤§æé«˜å­—ç¬¦ä¸²çš„åŒ¹é…é€Ÿåº¦ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š
æ–‡æœ¬å­—ç¬¦ä¸² -> ABCABCDDDEABCDABHJJEEIDAEAENN
æ¨¡å¼å­—ç¬¦ä¸² -> ABCDABC

åœ¨åŒ¹é…å‰éœ€è¦è®¡ç®—æœ€å¤§å‰ç¼€å’Œæœ€å¤§åç¼€çš„å…¬å…±å…ƒç´ é•¿åº¦ä»¥åŠnextæ•°ç»„ï¼ˆåé¢æœ‰è¯´æ˜ï¼‰ï¼š

|                     æ¨¡å¼ä¸²                       | A | B | C | D | A | B | C |
| ------------------------------- |  :-:  |  :-:  |  :-:  | :-:  |  :-:  | :-:  | :-: |
|æœ€å¤§å‰ç¼€å’Œåç¼€çš„å…¬å…±å…ƒç´ é•¿åº¦ | 0 | 0 | 0 | 0 | 1 | 2 | 3 |
|nextæ•°ç»„                                         | -1 | 0 | 0 | 0 | 0 | 1 | 2 |

å‡è®¾æ–‡æœ¬å­—ç¬¦ä¸²çš„ä¸‹æ ‡ä¸ºï¼š**i âˆˆ [0, pl-1]ï¼ˆplä¸ºæ–‡æœ¬å­—ç¬¦ä¸²çš„é•¿åº¦ï¼‰**ï¼Œæ¨¡å¼å­—ç¬¦ä¸²çš„ä¸‹æ ‡ä¸ºï¼š**j âˆˆ [0, sl-1]ï¼ˆslä¸ºæ¨¡å¼å­—ç¬¦ä¸²çš„é•¿åº¦ï¼‰**ï¼Œåˆ™ï¼š
```swift
æ–‡æœ¬å­—ç¬¦ä¸² -> ABCABCDDDEABCDABHJJEEIDAEAENN
æ¨¡å¼å­—ç¬¦ä¸² -> ABCDABC
KMPåŒ¹é…çš„è§„åˆ™ï¼š
åŠ å…¥å¤±é…å­—ç¬¦ä¸²çš„æ–‡å­—ä¸‹è¡¨ä¸ºjï¼Œåˆ™æ¨¡å¼å­—ç¬¦ä¸²å¾€å³ç§»çš„ä½æ•°ä¸ºå½“å‰å¤±é…å­—ç¬¦ä¸²çš„ä¸‹æ ‡ï¼ˆå·²åŒ¹é…çš„å­—ç¬¦ä¸²é•¿åº¦ï¼‰å‡å»å½“å‰å¤±é…å­—ç¬¦ä¸²çš„nextæ•°ç»„å¯¹åº”çš„æ•°å€¼ï¼Œæ­¤æ—¶æ¨¡å¼åŒ¹é…çš„ä¸‹æ ‡j=next[j]ã€‚

ABCABCDDDEABCDABHJJEEIDAEAENN
ABCDABC

å¤±é…å­—ç¬¦ä¸ºA|Dï¼Œæ‰€ä»¥
i = 3
j = 3
next[j] = 0
å¾€å³ç§»åŠ¨çš„ä½æ•° = j - next[j] = 3 - 0 = 3
j = next[j] = 0

ABCABCDDDEABCDABHJJEEIDAEAENN
   ABCDABC
ç»§ç»­åŒ¹é…ï¼Œç›´åˆ°j=sl-1æˆ–è€…i=pl-1ï¼ŒåŒ¹é…ç»“æŸã€‚å¦‚æœj=sl-1ï¼Œåˆ™åŒ¹é…æˆåŠŸï¼Œæ¨¡å¼å­—ç¬¦ä¸²åœ¨æ–‡æœ¬å­—ç¬¦ä¸²çš„ä½ç½®ä¸ºï¼šindex = i - jï¼Œå¦åˆ™ï¼ŒåŒ¹é…å¤±è´¥ã€‚
```

### KMPç®—æ³•çš„æ­¥éª¤
ä¸Šé¢ç®€å•çš„ä»‹ç»äº†ä¸€ä¸‹KMPå­—ç¬¦ä¸²åŒ¹é…ç®—æ³•çš„ä½¿ç”¨ï¼Œç°åœ¨è¯¦æƒ…ä»‹ç»ä¸€ä¸‹KMPç®—æ³•çš„å…·ä½“æ­¥éª¤ä»¥åŠä¸€äº›ç›¸å…³åè¯çš„æ„ä¹‰ã€‚

>æœ€å¤§å‰ç¼€å’Œåç¼€çš„å…¬å…±å…ƒç´ é•¿åº¦è®¡ç®—ã€‚

æ¨¡å¼å­—ç¬¦ä¸²ï¼š**ABCDABC**

| æ¨¡å¼å­—ç¬¦ä¸²çš„å­ä¸² | å‰ç¼€ | åç¼€ | æœ€å¤§çš„å…¬å…±å­—ç¬¦ä¸² | æœ€å¤§çš„å…¬å…±å­—ç¬¦ä¸²çš„é•¿åº¦ |
| -----------  | ---- | ----- | ------------------ | ----- |
| A | ç©º | ç©º | ç©º | 0 |
| AB | A | B | ç©º | 0 |
| ABC | A, AB | BC, C | ç©º | 0 |
| ABCD | A, AB, ABC | BCD, CD, D | ç©º | 0 |
| ABCDA | A, AB, ABC, ABCD | BCDA, CDA, DA, A | A | 1 |
| ABCDAB | A, AB, ABC, ABCD, ABCDA | BCDAB, CDAB, DAB, AB, B | AB | 2 |
| ABCDABC | A, AB, ABC, ABCD, ABCDA, ABCDAB | BCDABC, CDABC, DABC, ABC, BC, C | ABC | 3 |

æ‰€ä»¥ï¼Œæ¨¡å¼å­—ç¬¦ä¸²çš„å‰ç¼€åç¼€æœ€å¤§çš„å…¬å…±å…ƒç´ é•¿åº¦ä¸ºï¼š

|                     æ¨¡å¼ä¸²                       | A | B | C | D | A | B | C |
| ------------------------------- |  :-:  |  :-:  |  :-:  | :-:  |  :-:  | :-:  | :-: |
|æœ€å¤§å‰ç¼€å’Œåç¼€çš„å…¬å…±å…ƒç´ é•¿åº¦ | 0 | 0 | 0 | 0 | 1 | 2 | 3 |

>é‚£ä¹ˆï¼Ÿæœ€å¤§å‰ç¼€å’Œåç¼€çš„å…¬å…±å…ƒç´ é•¿åº¦æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ

ä¸¾ä¸ªä¾‹å­ï¼š
å‡å¦‚æ¨¡å¼å­—ç¬¦ä¸²åœ¨ **j=6** çš„åœ°æ–¹å¤±é…ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€ä¸éœ€è¦ä» **j=0**ï¼Œé‡æ–°å¼€å§‹åŒ¹é…å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚å› ä¸ºæœ€å¤§çš„å·²åŒ¹é…çš„å­—ç¬¦ä¸²é•¿åº¦ä¸º **6**ï¼Œæœ€å¤§çš„å‰ç¼€åç¼€çš„å…¬å…±å…ƒç´ é•¿åº¦ä¸º **2**ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‰ç¼€å’Œåç¼€æœ‰æœ€å¤§çš„å…¬å…±å…ƒç´ ABï¼Œé‚£ä¹ˆï¼ŒABè¿™ä¸ªå…ƒç´ åœ¨åç¼€æ˜¯åŒ¹é…è¿‡çš„ï¼Œä¸éœ€è¦é‡æ–°åŒ¹é…ï¼Œæ‰€ä»¥ï¼Œåªéœ€è¦ä»æ²¡æœ‰åŒ¹é…è¿‡çš„ä¸‹è¡¨å¼€å§‹å°±å¯ä»¥ï¼Œä¸‹æ ‡éœ€è¦å¾€å·¦ç§»åŠ¨çš„ä½æ•°ä¸º **6-2=4**ï¼Œä¹Ÿå°±æ˜¯ **j=6-4=2**ï¼Œä»ä¸‹æ ‡ **j=2** å³ **C** å¼€å§‹åŒ¹é…ï¼Œä¸éœ€è¦é‡æ–°åŒ¹é…ï¼ŒèŠ‚çœäº†æ—¶é—´ï¼Œæé«˜äº†åŒ¹é…çš„æ•ˆç‡ã€‚
<br>**å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ¨¡å¼å­—ç¬¦ä¸²å¤±é…æ—¶å¾€å·¦éœ€è¦ç§»åŠ¨ä½æ•°çš„å…¬å¼ï¼š**
**éœ€è¦ç§»åŠ¨çš„ä½æ•°ï¼ˆnï¼‰ = å½“å‰å·²åŒ¹é…çš„å­—ç¬¦ä¸²é•¿åº¦ï¼ˆjï¼‰ - å½“å‰å¤±é…å­—ç¬¦ä¸²ä¸Šä¸€ä¸ªå­—ç¬¦ä¸²çš„æœ€å¤§å‰ç¼€åç¼€çš„å…¬å…±å…ƒç´ é•¿åº¦ï¼ˆnext[j-1]ï¼‰**ã€‚

>ç†è®ºä¸Šæœ‰ **æœ€å¤§å‰ç¼€å’Œåç¼€çš„å…¬å…±å…ƒç´ é•¿åº¦** å°±å¯ä»¥è®¡ç®—æ¨¡å¼å­—ç¬¦ä¸²åœ¨åŒ¹é…å¤±è´¥æ—¶éœ€è¦å¾€å·¦ç§»åŠ¨çš„ä½æ•°ï¼Œé‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ **next** æ•°ç»„ï¼Ÿ

åœ¨`ä»€ä¹ˆæ˜¯KMPç®—æ³•`ä¸€èŠ‚é‡Œï¼Œå¯ä»¥çœ‹å‡ºï¼Œ**nextæ•°ç»„** å’Œ **æœ€å¤§å‰ç¼€å’Œåç¼€çš„å…¬å…±å…ƒç´ é•¿åº¦** æ•°å€¼çš„å…³ç³»ï¼Œ**nextæ•°ç»„** å°±æ˜¯ **æœ€å¤§å‰ç¼€å’Œåç¼€çš„å…¬å…±å…ƒç´ é•¿åº¦** æ•´ä½“å¾€åç§»ä¸€ä½ï¼Œè¶…å‡ºçš„å»æ‰ï¼Œä¸è¶³çš„è¡¥-1ã€‚é‚£ä¹ˆå…¶å®ï¼Œå‰é¢å¾—å‡ºæ¥çš„å…¬å¼å°±å¯ä»¥å†™æˆè¿™æ ·ï¼š
**n = j - next[j]**
åˆ°æ­¤ï¼Œå¯ä»¥çŸ¥é“ï¼Œ**nextæ•°ç»„** å°±æ˜¯ä¸ºäº†ç®€åŒ–å…¬å¼è€Œå¼„å‡ºæ¥çš„ã€‚

>ç°åœ¨å†é‡æ–°åŒ¹é…ä¸€æ¬¡ã€Šä»€ä¹ˆæ˜¯KMPç®—æ³•ï¼Ÿã€‹é‡Œçš„ä¾‹å­

```
æ–‡æœ¬å­—ç¬¦ä¸² -> ABCABCDDDEABCDABHJJEEIDAEAENN
æ¨¡å¼å­—ç¬¦ä¸² -> ABCDABC
pl(æ–‡æœ¬å­—ç¬¦ä¸²çš„é•¿åº¦)
sl(æ¨¡å¼å­—ç¬¦ä¸²çš„é•¿åº¦)
i(æ–‡æœ¬å­—ç¬¦ä¸²çš„ä¸‹æ ‡)
j(æ¨¡å¼å­—ç¬¦ä¸²çš„ä¸‹æ ‡)
n(éœ€è¦ç§»åŠ¨çš„ä½æ•°)
```

|                     æ¨¡å¼ä¸²                       | A | B | C | D | A | B | C |
| ------------------------------- |  :-:  |  :-:  |  :-:  | :-:  |  :-:  | :-:  | :-: |
|æœ€å¤§å‰ç¼€å’Œåç¼€çš„å…¬å…±å…ƒç´ é•¿åº¦ | 0 | 0 | 0 | 0 | 1 | 2 | 3 |
|nextæ•°ç»„                                         | -1 | 0 | 0 | 0 | 0 | 1 | 2 |

**ç¬¬ä¸€æ¬¡åŒ¹é…å¤±è´¥ï¼š**

![ç¬¬ä¸€æ¬¡åŒ¹é…å¤±è´¥.png](http://upload-images.jianshu.io/upload_images/968977-7e938a94bd83f7b3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

```
i = 3
j = 3
n = j - next[j] = 3 - 0 = 3
j = next[j] = 0
æ‰€ä»¥ï¼Œä»æ–‡æœ¬å­—ç¬¦ä¸²i=3ï¼Œæ¨¡å¼å­—ç¬¦ä¸²j=0å¼€å§‹é‡æ–°åŒ¹é…ã€‚
```

**ç¬¬äºŒæ¬¡åŒ¹é…**
![ç¬¬äºŒæ¬¡åŒ¹é….png](http://upload-images.jianshu.io/upload_images/968977-9e533b923fb68f7b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

```
i = 7
j = 4
n = j - next[j] = 4 - 0 = 4
j = next[j] = 0
æ‰€ä»¥ï¼Œä»æ–‡æœ¬å­—ç¬¦ä¸²i=7ï¼Œæ¨¡å¼å­—ç¬¦ä¸²j=0å¼€å§‹é‡æ–°åŒ¹é…ã€‚
```
ç›´åˆ°æœ€åi=pl-1æ—¶ï¼Œj != sl-1ï¼ŒåŒ¹é…å¤±è´¥ã€‚

>ä½¿ç”¨ä»£ç å®ç°KMPç®—æ³•

é¦–å…ˆï¼Œéœ€è¦è®¡ç®—æ¨¡å¼å­—ç¬¦ä¸²çš„nextæ•°ç»„ã€‚
å¾ˆæ˜¾ç„¶ï¼Œj = 0æ—¶ï¼Œnext[0] = -1ï¼›
é‚£ä¹ˆï¼Ÿæ€ä¹ˆä»next[j]æ¨å¯¼next[j+1]å‘¢ï¼Ÿ

å‡å¦‚j = 5ï¼Œæˆ‘ä»¬çŸ¥é“next[j] = 1ï¼Œs[next[j]] = Bï¼Œä¹Ÿå°±æ˜¯æœ€å¤§çš„å…¬å…±å…ƒç´ æ˜¯ABï¼Œå‡å¦‚s[next[j] + 1] = s[j + 1]ï¼Œ é‚£ä¹ˆå¯ä»¥å¾—å‡ºï¼Œå‰ç¼€å’Œåç¼€æœ€å¤§çš„å…¬å…±å…ƒç´ æ˜¯ABCï¼Œ åˆ™next[j + 1] = 2ã€‚è¿™é‡Œå¯ä»¥å¾—å‡ºï¼Œå½“s[next[j] + 1] = s[j + 1]åˆ™ï¼Œnext[j + 1] = next[j] + 1ã€‚å¦‚æœs[next[j] + 1] != s[j + 1]å‘¢ï¼Ÿé‚£ä¹ˆï¼Œæˆ‘ä»¬å‡å®šå­˜åœ¨ä¸€ä¸ªæ¯”ABCå°çš„æœ€å¤§å‰ç¼€åç¼€å…¬å…±å…ƒç´ ï¼Œéœ€è¦ä¸æ–­é€’å½’ï¼Œç›´åˆ°s[next[next[j]] + 1] = s[j + 1]ã€‚å¦‚æœå­˜åœ¨kï¼Œä½¿å¾—s[next[k] + 1] = s[j + 1]ï¼Œåˆ™next[j + 1] = next[k] + 1ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™next[j + 1] = 0ã€‚

ä»£ç å¦‚ä¸‹ï¼š
```swift
    //KMPè®¡ç®—nextæ•°ç»„
    func nextTable(_ matchStr: String) -> [Int] {
        guard matchStr.count > 0 else {
            return []
        }
        
        let length = matchStr.count
        var next: [Int] = [-1]
        var k = -1
        var j = 0
        while j < length - 1 {
            //p[k]è¡¨ç¤ºå‰ç¼€,p[j]è¡¨ç¤ºåç¼€
            if k == -1 || matchStr.subStrAtIndex(j) == matchStr.subStrAtIndex(k) {
                k = k + 1
                j = j + 1
                next.insert(k, at: j)
            } else {
                k = next[k]
            }
        }
        return next
    }
```
å½“k=-1è¡¨ç¤ºj=0ï¼Œæ­¤æ—¶next[j+1]=k+1=0
å½“s[j]=s[k]è¡¨ç¤ºæ‰¾åˆ°äº†ï¼Œæ­¤æ—¶next[j+1]=next[k]+1

è·å¾—æ¨¡å¼å­—ç¬¦ä¸²çš„nextæ•°ç»„ï¼Œå¯ä»¥å¼€å§‹åŒ¹é…äº†ï¼Œä»£ç å¦‚ä¸‹ï¼š
```swift
    //KMPï¼Œå­—ç¬¦ä¸²åŒ¹é…ç®—æ³• => O(n+m)
    func matchSubStr(_ subStr: String) -> (Bool, Int) {
        guard !subStr.isEmpty else {
            return (false, -1)
        }
        
        let next: [Int] = self.nextTable(subStr)
        
        var i = 0  //æ–‡æœ¬ä¸²
        var j = 0  //æ¨¡å¼ä¸²
        let length = self.count
        let matchLenghth = subStr.count
        
        while i < length && j < matchLenghth {
            if j == -1 || self.subStrAtIndex(i) == subStr.subStrAtIndex(j) {
                i = i + 1
                j = j + 1
            } else {
                j = next[j]
            }
        }
        
        if j == matchLenghth {
            return (true, i - j)
        } else {
            return (false, -1)
        }
    }
```
**KMPå­—ç¬¦ä¸²åŒ¹é…ç®—æ³•è¦ç‚¹åœ¨äºå‡å°‘æ¯”ä¸è¦çš„åŒ¹é…æ¬¡æ•°ï¼Œæé«˜åŒ¹é…æ•ˆç‡ã€‚**

### BMç®—æ³•å’ŒSundayç®—æ³•
KMPç®—æ³•ï¼Œå·²ç»åœ¨å­—ç¬¦ä¸²åŒ¹é…çš„æ•ˆç‡ä¸Šæå‡äº†ä¸€ä¸ªçº§åˆ«ï¼Œç„¶è€Œï¼Œæ²¡æœ‰æœ€å¿«çš„ç®—æ³•ï¼Œåªæœ‰æ›´å¿«çš„ç®—æ³•ã€‚BMç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯ **O(n)** çº§åˆ«çš„ï¼Œè€ŒSundayç®—æ³•æ¯”BMç®—æ³•æ•ˆç‡æ›´é«˜ã€‚æ„ä¸æ„å¤–ï¼ŒæƒŠä¸æƒŠå–œã€‚å¤§ç¥çš„å¢ƒç•Œè¿œä¸æ˜¯æˆ‘ç­‰å‡¡äººå¯ä»¥æ£æ‘©çš„ï¼Œè‡´æ•¬ã€‚ğŸ˜‚

### æœ€å
çŒ®ä¸ŠSwiftå†™çš„[KMP-Algorithm-Swift-Demo](https://github.com/jashion/KMP-Algorithm-Swift)ã€‚

>å‚è€ƒæ–‡çŒ®ï¼š
[æå®¢å­¦é™¢ï¼šKMPç®—æ³•](http://wiki.jikexueyuan.com/project/kmp-algorithm/define.html)
[é˜®ä¸€å³°ï¼šå­—ç¬¦ä¸²åŒ¹é…çš„KMPç®—æ³•](http://www.ruanyifeng.com/blog/2013/05/Knuth%E2%80%93Morris%E2%80%93Pratt_algorithm.html)
[The Knuth-Morris-Pratt Algorithm in my own words](http://jakeboxer.com/blog/2009/12/13/the-knuth-morris-pratt-algorithm-in-my-own-words/)
